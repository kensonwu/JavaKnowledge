# Java网络编程
#### 网络分层
###### ISO/OSI参考模型(理论模型)
- 应用层
- 表示层
- 会话层
- 传输层
- 网络层
- 数据链路层
- 物理层
###### TCP/IP参考模型(实际使用的模型)
- **应用层** (HTTP协议、SMTP协议、FTP协议、TELNET、DNS等应用协议)
- **传输层** (TCP协议、UDP协议)
- **网络层** (IP、ARP、RARP、ICMP)
- **数据量路+物理层** (各种网络接口以太网口等, 物理网络)
    - 可以参考 [javase_networkprogramming/src/com/kenson/network/note/TCPIP模型.jpg]()
    - TCP/IP意味这TCP与IP协同工作，TCP负责应用软件(如你的浏览器)与网络软件之间通信。IP负责计算机之间的通信。TCP把数据分割并装入IP包,然后在他们到达的时候重新组装。IP负责把包发送至目的地。
###### TCP协议
- TCP(Transfer Control Protocol)是一种面向连接的、可靠的、基于字节流的传输层(Transportlayer)的通信协议
- 特点：
    - 面向连接
    - 点到点通信
    - 高可靠性：三次握手
    - 占用资源多、效率低
- 案例： 打电话
- 应用案例： HTTP、FTP、TELNET、SMTP
###### TCP的三次握手建立连接过程
- 所谓三次握手指的是建立TCP连接，建立一个TCP连接时，客户端和服务端需要发送3个包以确认连接的监理，socket编程中这一过程由客户端执行connect时触发。
1. 第一次握手：客户端发送SYN=1,seq=J给服务器端， 客户端变为SYN_SENT状态,等待服务端确认。
2. 第二次握手：服务器端收到数据包后,根据SYN=1知道客户端请求连接, 然后服务端把SYN设置为1,ACK=J+1,同时产生一个随机seq=K, 将该数据包发送给客户端确认连接请求, 服务器端进入SYN_RCVD状态
3. 第三次握手：客户端收到确认后, 检查ACK是否为J+1, ACK是否为1, 如果正确则将标志位ACK设置为1, ACK=K+1,并将改数据包发送给 服务端。 服务端检查ACK是否为K+1,ACK是否为1，如果正确则成功建立连接, 客户端和服务端都进入ESTABLISHED状态，完成三次握手,最终客户端和服务端进行数据传输。
###### TCP的四次挥手断开连接
- 所谓四次挥手即终止TCP连接, 就是断开一个TCP连接时,需要客户端和服务端总共发送4个包来确认连接断开。socket编程中，这个过程由客户端或服务端任一方触发。
1. 第一次挥手：客户端发送一个FIN，用来关闭客户端到服务端的数据传送，客户端进入FIN_WAIT_1状态。
2. 第二次挥手：服务端收到FIN后，发送ACK给客户端，确认序号收到， 序号+1,服务端进入CLOSE_WAIT状态。
3. 第三次挥手：服务端发送一个FIN，用来关闭服务端到客户端的数据传送，服务端进入LAST_ACK状态
4. 第四次挥手：客户端收到FIN后，客户端进入TIME_WAIT状态，接着发送一个ACK给服务端，确认序号为收到序号+1，服务端进入CLOSED状态，完成四次挥手。
###### UDP协议
- UDP(User Datagram Protocol)是一种无连接的传输层协议,提供面向事务的简单不可靠信息传输服务
- 特点：
    - 非面向连接, 传输不可靠, 可能丢失
    - 发送不管对方是否准备好,接收方收到也确定
    - 可以广播发送
    - 非常简单的协议、开销小
- 案例： 发短信、发电报
- 应用案例： DNS、SNMP
###### IP地址
- IP地址 用来标识网络中一个通信实体的地址。通信实体可以是计算机、路由器等。
- IP地址分类
    - IPV4: 32位地址，以点分十进制表示，如：192.168.0.1 (192的二进制是：10000000)
    - IPV6: 128为(16个字节)写成8个16位的无符号整数, 每个整数用4个十六进制位表示,数之间用冒号(:)分开, 如：ABCD:EF01:2345:6789:ABCD:EF01:2345:6789
- 特殊的IP地址
    - 127.0.0.1表示本机地址
    - 192.168.0.0 -- 192.168.255.255私有地址,属于非注册地址,专门为组织机头内部使用(可以通过ping 域名 验证互联网上的IP是否在此段IP范围内)
###### 端口
- IP地址是标识一台计算机，那么端口用来区分计算机上的应用
- 端口是虚拟概念,并不是说在主机上真的有若干个端口。通过端口,可以在一个主机上裕兴多个网络应用程序。
- 端口的范围 0 --- 65535, 16位整数
- 理解IP与Port的关系： IP好比电话号码，端口相当于分机号
- 端口分类：
    - 公认端口 0 -- 1023, 比如80分配给WWW, 21分配给了FTP, 3306-MYSQL, 1521-ORACLE, 1433-SQLSERVER等
    - 注册端口 1024 -- 49151 分配给用户进程或应用程序
    - 动态/私有端口 49152 -- 65535
###### HTTP协议
- 它是互联网协议(Internet Protocol Suite)，一个网络通信模型，是互联网的一个基本的构架。
- HTTP协议是Hyper Text Transfer Protocol（超文本传输协议）的缩写,是用于从万维网（WWW:World Wide Web ）服务器传输超文本到本地浏览器的传送协议。
- HTTP是一个基于TCP/IP通信协议来传递数据（HTML 文件, 图片文件, 查询结果等）。
- HTTP是一个属于应用层的面向对象的协议，由于其简捷、快速的方式，适用于分布式超媒体信息系统。它于1990年提出，经过几年的使用与发展，得到不断地完善和扩展。目前在WWW中使用的是HTTP/1.0的第六版，HTTP/1.1的规范化工作正在进行之中，而且HTTP-NG(Next Generation of HTTP)的建议已经提出。
- HTTP协议工作于客户端-服务端架构为上。浏览器作为HTTP客户端通过URL向HTTP服务端即WEB服务器发送所有请求。Web服务器根据接收到的请求后，向客户端发送响应信息。
- TCP/IP协议它们并不是一个协议，而是一个协议簇，这些协议的目的，就是使计算机之间可以进行信息交换，并且两大协议其中都包含其他的协议，虽然放在了一起，但它们的作用和工作是不一样的。
- HTTP协议定义了内容的格式，这是一个应用层的协议，应用层协议的内容需要通过传输层在浏览器和服务器之间传送，TCP/IP协议是ISO网络参考模型的一种实现。在TCP/IP协议中，与网络程序员相关的主要有两层：传输层和应用层。
- 传输层协议负责解决数据传输问题，包括数据通行的可靠性问题。传输层依赖更底层的网络层来完成实际的数据传输，在TCP/IP网络协议中，负责可靠通信的传输层协议为TCP协议。而网络层一般用网络驱动来实现，普通的程序员不会涉及；在TCP/IP协议中，网络层的协议为IP协议。
###### 客户端、web服务器、HTTP三者之间的联系
1. 客户端与web服务器工作过程
* 当浏览器寻找到Web服务器的地址之后，浏览器帮助我们把对服务器的请求转换为一系列参数发送给Web服务器。服务器接受到浏览器发来的请求参数之后，将会分析这些数据，并进行处理。然后向浏览器回应处理的结果，也就是一些新的数据；这些数据通常是HTML网页或者图片。浏览器收到之后，解析这些数据，将它们呈现在浏览器的窗口中，这就是我们看到的网页。
2. 客户端与web服务器遵守共同标准：HTTP协议
* 在浏览器与Web服务器的对话中，需要使用双方都能够理解的语法规范进行通信，这种程序之间进行通信的语法规范，我们称之为协议。协议有许多种，根据国际标准化组织ISO的网络参考模型，程序与程序之间的通信可分为7层，从低到高依次为：物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。